<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ê¸‰ì‹ì§€ë„ êµì‚¬ì¡°íšŒ</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ê¸‰ì‹ì§€ë„">
<meta name="theme-color" content="#d97642">
<link rel="manifest" id="manifest-placeholder">
<style>
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: linear-gradient(160deg, #3d2817, #5d4037);
    min-height: 100vh;
    padding: 16px 16px 60px;
}
.wrap { max-width: 500px; margin: 0 auto; }
.header {
    background: linear-gradient(135deg, #d97642, #c8622f);
    border-radius: 20px;
    padding: 28px 24px;
    margin-bottom: 16px;
    box-shadow: 0 10px 30px rgba(217,118,66,0.4);
    text-align: center;
}
.header h1 { font-size: 28px; font-weight: 900; color: white; margin-bottom: 4px; }
.header p  { color: rgba(255,255,255,0.9); font-size: 14px; }
.card {
    background: white;
    border-radius: 16px;
    padding: 22px;
    margin-bottom: 14px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}
.card-title { font-size: 17px; font-weight: 900; color: #3d2817; margin-bottom: 14px; }
input[type=text] {
    width: 100%;
    padding: 16px 18px;
    border: 2.5px solid #e8d5c4;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 700;
    color: #3d2817;
    outline: none;
    transition: border-color 0.2s;
}
input[type=text]:focus { border-color: #d97642; }
.btn {
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 900;
    cursor: pointer;
    transition: transform 0.1s;
}
.btn:active { transform: scale(0.98); }
.btn-main { background: linear-gradient(135deg, #d97642, #c8622f); color: white; }
.btn-refresh { 
    padding: 10px 16px;
    background: linear-gradient(135deg, #059669, #047857);
    color: white;
    font-size: 14px;
}
.month-tabs { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
.month-tab {
    padding: 11px 18px;
    border-radius: 10px;
    border: 2px solid #e8d5c4;
    background: white;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    color: #8d6e63;
    transition: all 0.15s;
}
.month-tab.active {
    background: linear-gradient(135deg, #d97642, #c8622f);
    border-color: #d97642;
    color: white;
}
.stats { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-top: 12px; }
.stat { background: #faf8f5; border-radius: 10px; padding: 14px 10px; text-align: center; }
.stat-label { font-size: 11px; color: #8d6e63; font-weight: 700; margin-bottom: 5px; }
.stat-value { font-size: 23px; font-weight: 900; color: #d97642; }
.duty {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    border-left: 5px solid #2d6a4f;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 10px;
}
.duty-date { font-size: 18px; font-weight: 900; color: #1b4332; margin-bottom: 6px; }
.duty-info { font-size: 14px; font-weight: 600; color: #2d6a4f; margin-bottom: 3px; }
.next-duty {
    margin-top: 10px;
    background: #fff8f0;
    border: 2px solid #d97642;
    border-radius: 8px;
    padding: 11px 14px;
    font-size: 13px;
    font-weight: 700;
    color: #c8622f;
    line-height: 1.6;
}
.msg {
    padding: 13px 18px;
    border-radius: 10px;
    margin-bottom: 14px;
    font-size: 14px;
    font-weight: 700;
}
.msg-green { background: #d1fae5; color: #065f46; }
.msg-red { background: #fee2e2; color: #991b1b; }
.msg-orange { background: #fff7ed; color: #9a3412; }
table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 12px; }
th { background: #f0ebe3; padding: 10px 6px; text-align: center; font-weight: 900; border: 1px solid #e8d5c4; color: #3d2817; }
td { padding: 8px 6px; border: 1px solid #e8d5c4; vertical-align: top; }
.chip {
    display: inline-block;
    padding: 3px 7px;
    border-radius: 5px;
    margin: 2px;
    font-size: 11px;
    font-weight: 600;
    background: #f5f5f5;
    color: #3d2817;
}
.chip-me {
    background: #fef08a;
    color: #713f12;
    font-weight: 900;
    border: 1px solid #fde047;
}
.footer { 
    text-align: center; 
    padding: 24px 0; 
    color: rgba(255,255,255,0.35); 
    font-size: 11px; 
}
</style>
</head>
<body>
<div class="wrap">
    <div class="header">
        <h1>ğŸ½ï¸ ê¸‰ì‹ì§€ë„ êµì‚¬ì¡°íšŒ</h1>
        <p>ê°œì¸ ì¼ì • ì¡°íšŒ ì•±</p>
    </div>

    <div id="msg-area"></div>

    <div class="card" id="url-card">
        <div class="card-title">ğŸ”— ê´€ë¦¬ì URL ì—°ê²°</div>
        <p style="font-size:13px;color:#666;margin-bottom:12px;line-height:1.6">
            ê´€ë¦¬ìì—ê²Œ ë°›ì€ Google Apps Script URLì„ ì…ë ¥í•˜ì„¸ìš”
        </p>
        <input type="text" id="url-input" placeholder="https://script.google.com/macros/s/..." style="margin-bottom:10px">
        <button class="btn btn-main" onclick="connect()">ğŸ”— ì—°ê²°í•˜ê¸°</button>
    </div>

    <div class="card" id="query-card" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
            <div class="card-title" style="margin:0">ğŸ‘¤ ì´ë¦„ ì…ë ¥</div>
            <button class="btn btn-refresh" onclick="refreshData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <input type="text" id="name-input" placeholder="ì˜ˆ: í™ê¸¸ë™" oninput="search()">
        <div id="month-area"></div>
    </div>

    <div id="result-area"></div>
    <div id="table-area"></div>

    <div class="footer">Designed by Song HwaYoung | Ver 1.0 | 2026. 02. 17</div>
</div>

<script>
// manifest ë™ì  ìƒì„±
const manifestBlob = new Blob([JSON.stringify({
    name: "ê¸‰ì‹ì§€ë„ êµì‚¬ì¡°íšŒ",
    short_name: "ê¸‰ì‹ì§€ë„",
    start_url: "./",
    display: "standalone",
    background_color: "#5d4037",
    theme_color: "#d97642",
    icons: [{
        src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>ğŸ½ï¸</text></svg>",
        sizes: "192x192",
        type: "image/svg+xml"
    }]
})], { type: 'application/json' });
const manifestURL = URL.createObjectURL(manifestBlob);
document.getElementById('manifest-placeholder').setAttribute('href', manifestURL);

var schedules = [];
var selMonth = '';
var tableVisible = false;

// GAS URL ê³ ì • (ìˆ˜ì • ê¸ˆì§€)
var GAS_URL = 'https://script.google.com/macros/s/AKfycbzTSy7MVwW2Zs9TJppMaxuFoOQxtlh6rmmRE-gS9d8m3dFcazzMyyyCgXVTu0EZV_N8/exec';

window.onload = function() {
    // ì €ì¥ëœ URLì´ ìˆìœ¼ë©´ ì…ë ¥ì°½ì— í‘œì‹œ
    var savedUrl = localStorage.getItem('lunchDutyGasUrl') || GAS_URL;
    document.getElementById('url-input').value = savedUrl;

    // ìºì‹œëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¨¼ì € í‘œì‹œ
    var cached = localStorage.getItem('lunchDutySavedSchedules');
    if (cached) {
        try {
            var arr = JSON.parse(cached);
            if (arr && arr.length > 0) {
                var uniqueData = {};
                arr.forEach(function(item) {
                    var key = item.year + '-' + item.month;
                    if (!uniqueData[key] || (item.savedAt && uniqueData[key].savedAt && item.savedAt > uniqueData[key].savedAt)) {
                        uniqueData[key] = item;
                    }
                });
                schedules = Object.values(uniqueData);
                showMsg('âœ… ì €ì¥ëœ ë°ì´í„°: ' + schedules.map(function(s){ return s.year+'ë…„ '+s.month+'ì›”'; }).join(', '), 'green');
                showQueryCard();
            }
        } catch(e) {}
    }

    // ì„œë²„ì—ì„œ ìµœì‹  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    loadFromSheets(savedUrl);
};

function loadFromSheets(url) {
    url = url || GAS_URL;
    showMsg('â³ ìµœì‹  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'orange');
    
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url + '?action=load', true);
    xhr.onload = function() {
        try {
            var json = JSON.parse(xhr.responseText);
            if (json.success && json.data && json.data.length > 0) {
                // ì¤‘ë³µ ì œê±°: ê°™ì€ ë…„-ì›”ì´ ì—¬ëŸ¬ ê°œë©´ ìµœì‹  ê²ƒë§Œ ë‚¨ê¹€
                var uniqueData = {};
                json.data.forEach(function(item) {
                    var key = item.year + '-' + item.month;
                    // ê°™ì€ í‚¤ê°€ ìˆìœ¼ë©´ savedAtì´ ë” ìµœì‹ ì¸ ê²ƒìœ¼ë¡œ êµì²´
                    if (!uniqueData[key] || (item.savedAt && uniqueData[key].savedAt && item.savedAt > uniqueData[key].savedAt)) {
                        uniqueData[key] = item;
                    } else if (!uniqueData[key]) {
                        uniqueData[key] = item;
                    }
                });
                
                // ê°ì²´ë¥¼ ë°°ì—´ë¡œ ë³€í™˜
                schedules = Object.values(uniqueData);
                
                localStorage.setItem('lunchDutySavedSchedules', JSON.stringify(schedules));
                showMsg('âœ… ìµœì‹  ë°ì´í„°: ' + schedules.map(function(s){ return s.year+'ë…„ '+s.month+'ì›”'; }).join(', '), 'green');
                showQueryCard();
            } else {
                if (schedules.length === 0) {
                    showMsg('âš ï¸ ì„œë²„ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìê°€ ì—…ë¡œë“œí•´ì•¼ í•´ìš”.', 'orange');
                }
            }
        } catch(e) {
            if (schedules.length > 0) {
                showMsg('ğŸ“± ì €ì¥ëœ ë°ì´í„° ì‚¬ìš© ì¤‘', 'orange');
            } else {
                showMsg('âŒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', 'red');
            }
        }
    };
    xhr.onerror = function() {
        if (schedules.length > 0) {
            showMsg('ğŸ“± ì˜¤í”„ë¼ì¸ ëª¨ë“œ (ì €ì¥ëœ ë°ì´í„° ì‚¬ìš©)', 'orange');
        } else {
            showMsg('âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨', 'red');
        }
    };
    xhr.send();
}

function connect() {
    var url = document.getElementById('url-input').value.trim();
    if (!url) {
        showMsg('âŒ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'red');
        return;
    }
    localStorage.setItem('lunchDutyGasUrl', url);
    GAS_URL = url;
    loadFromSheets(url);
}

function refreshData() {
    var url = localStorage.getItem('lunchDutyGasUrl') || GAS_URL;
    loadFromSheets(url);
}

function showQueryCard() {
    document.getElementById('query-card').style.display = 'block';
    if (!selMonth && schedules.length > 0) {
        var last = schedules[schedules.length-1];
        selMonth = last.year + '-' + last.month;
    }
    renderMonthTabs();
}

function renderMonthTabs() {
    var html = '<div class="month-tabs">';
    schedules.forEach(function(s) {
        var key = s.year + '-' + s.month;
        var active = selMonth === key;
        html += '<button onclick="selectMonth(\'' + key + '\')" class="month-tab' + (active ? ' active' : '') + '">' + s.month + 'ì›”</button>';
    });
    html += '</div>';
    document.getElementById('month-area').innerHTML = html;
    search();
}

function selectMonth(key) {
    selMonth = key;
    tableVisible = false;
    renderMonthTabs();
}

function search() {
    var name = document.getElementById('name-input').value.trim();
    var resultArea = document.getElementById('result-area');
    var tableArea = document.getElementById('table-area');
    
    if (!name || !selMonth) {
        resultArea.innerHTML = '';
        tableArea.innerHTML = '';
        return;
    }

    var parts = selMonth.split('-');
    var y = parseInt(parts[0]);
    var m = parseInt(parts[1]);
    
    var d = null;
    for (var i = 0; i < schedules.length; i++) {
        if (schedules[i].year === y && schedules[i].month === m) {
            d = schedules[i];
            break;
        }
    }
    
    if (!d) return;

    var duties = getDuties(d, name);
    var total = getTotalCount(name);

    // í†µê³„
    var html = '<div class="card"><div class="card-title">ğŸ“Š ' + name + ' ì„ ìƒë‹˜ í†µê³„</div>';
    html += '<div class="stats">';
    html += '<div class="stat"><div class="stat-label">ì´ë²ˆ ë‹¬</div><div class="stat-value">' + duties.length + 'ì¼</div></div>';
    html += '<div class="stat"><div class="stat-label">ì „ì²´ ëˆ„ì </div><div class="stat-value">' + total + 'ì¼</div></div>';
    html += '<div class="stat"><div class="stat-label">ì²« ë‹´ë‹¹ì¼</div><div class="stat-value" style="font-size:16px">' + (duties.length > 0 ? duties[0].date : '-') + '</div></div>';
    html += '</div></div>';

    // ë‚´ ì¼ì •
    html += '<div class="card"><div class="card-title">ğŸ“‹ ' + m + 'ì›” ë‚´ ë‹´ë‹¹ ì¼ì •</div>';
    if (duties.length === 0) {
        html += '<p style="text-align:center;padding:24px;color:#999;font-size:14px">ì´ë²ˆ ë‹¬ ë°°ì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
    } else {
        duties.forEach(function(item) {
            var next = getNext(d, item);
            html += '<div class="duty">';
            html += '<div class="duty-date">ğŸ“… ' + item.date + ' (' + item.dow + ')</div>';
            html += '<div class="duty-info">ğŸ« ' + item.grade + ' ê¸‰ì‹ì§€ë„</div>';
            if (item.loc) html += '<div class="duty-info">ğŸ“ ' + item.loc + '</div>';
            if (next) html += '<div class="next-duty">ğŸ”„ ë‹¤ìŒ ë‹´ë‹¹: <strong>' + next.name + '</strong> (' + next.date + ')<br>â†’ íŒ»ë§ì„ ' + next.name + ' ì„ ìƒë‹˜ê»˜ ì „ë‹¬í•˜ì„¸ìš”!</div>';
            html += '</div>';
        });
    }
    html += '</div>';
    
    resultArea.innerHTML = html;

    // ì „ì²´ ë°°ì •í‘œ ë²„íŠ¼
    tableArea.innerHTML = '<div class="card"><div class="card-title">ğŸ“‹ ' + m + 'ì›” ì „ì²´ ë°°ì • ê²°ê³¼</div><button class="btn" onclick="toggleTable()" id="table-btn" style="background:linear-gradient(135deg,#7c3aed,#6d28d9);color:white">ğŸ“‹ ì „ì²´ ë°°ì • ê²°ê³¼ ë³´ê¸° [í´ë¦­]</button><div id="table-content"></div></div>';
}

function toggleTable() {
    tableVisible = !tableVisible;
    var btn = document.getElementById('table-btn');
    btn.textContent = tableVisible ? 'ğŸ‘¤ ë‚´ ë‹´ë‹¹ì¼ë§Œ ë³´ê¸° [í´ë¦­]' : 'ğŸ“‹ ì „ì²´ ë°°ì • ê²°ê³¼ ë³´ê¸° [í´ë¦­]';
    if (tableVisible) renderTable();
    else document.getElementById('table-content').innerHTML = '';
}

function renderTable() {
    var name = document.getElementById('name-input').value.trim();
    var parts = selMonth.split('-');
    var y = parseInt(parts[0]);
    var m = parseInt(parts[1]);
    
    var d = null;
    for (var i = 0; i < schedules.length; i++) {
        if (schedules[i].year === y && schedules[i].month === m) {
            d = schedules[i];
            break;
        }
    }
    if (!d) return;

    var duties = getDuties(d, name);
    var myDays = {};
    duties.forEach(function(duty) {
        myDays[duty.day] = true;
    });

    var html = '<div style="overflow-x:auto"><table><thead><tr><th>ë‚ ì§œ</th><th>ìš”ì¼</th><th>1í•™ë…„</th><th>2í•™ë…„</th><th>3í•™ë…„</th></tr></thead><tbody>';
    
    for (var day = 1; day <= 31; day++) {
        var mm = String(m).padStart(2, '0');
        var dd = String(day).padStart(2, '0');
        var dateKey = y + '-' + mm + '-' + dd;
        var daySchedule = d.schedule[dateKey];
        
        if (!daySchedule) continue;
        
        var date = new Date(y, m - 1, day);
        if (date.getMonth() !== m - 1) break;
        
        var dow = date.getDay();
        if (dow === 0 || dow === 6) continue;
        
        var dowStr = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][dow];
        var isMyDay = myDays[day];
        
        html += '<tr style="background:' + (isMyDay ? '#dcfce7' : (day % 2 === 0 ? 'white' : '#fafafa')) + '">';
        html += '<td style="font-weight:bold;white-space:nowrap">' + m + 'ì›” ' + day + 'ì¼' + (isMyDay ? ' â­' : '') + '</td>';
        html += '<td style="text-align:center">' + dowStr + '</td>';
        
        ['grade1', 'grade2', 'grade3'].forEach(function(gradeId) {
            html += '<td>';
            var assignments = daySchedule[gradeId] || [];
            var hasTeacher = false;
            
            // ì‹¤ì œ ë°°ì •ëœ ì¸ì› ìˆ˜ ê³„ì‚° (1ëª…ì´ë©´ ìœ„ì¹˜ í‘œì‹œ ì•ˆ í•¨)
            var assignedCount = assignments.filter(function(a) { return a && a.teacherId; }).length;
            
            assignments.forEach(function(assignment) {
                if (!assignment || !assignment.teacherId) return;
                
                var teacher = null;
                for (var i = 0; i < d.teachers.length; i++) {
                    if (d.teachers[i].id === assignment.teacherId) {
                        teacher = d.teachers[i];
                        break;
                    }
                }
                
                if (!teacher) return;
                
                var loc = assignedCount > 1 ? (
                    assignment.location === 'stairs' ? '(ê³„ë‹¨)' : 
                    assignment.location === 'entrance' ? '(ì…êµ¬)' : ''
                ) : '';
                var isMe = teacher.name === name;
                
                html += '<span class="chip' + (isMe ? ' chip-me' : '') + '">' + teacher.name + loc + '</span>';
                hasTeacher = true;
            });
            
            if (!hasTeacher) {
                html += '<span style="color:#ccc">-</span>';
            }
            html += '</td>';
        });
        
        html += '</tr>';
    }
    
    html += '</tbody></table></div>';
    html += '<p style="font-size:11px;color:#999;margin-top:8px">â­ ì´ˆë¡ = ë‚´ ë‹´ë‹¹ì¼ | ğŸŸ¡ ë…¸ë€ ì´ë¦„ = ë‚˜</p>';
    
    document.getElementById('table-content').innerHTML = html;
}

function getDuties(d, name) {
    var result = [];
    
    Object.keys(d.schedule).forEach(function(dateKey) {
        var parts = dateKey.split('-');
        var y = parseInt(parts[0]);
        var m = parseInt(parts[1]);
        var day = parseInt(parts[2]);
        
        if (y !== d.year || m !== d.month) return;
        
        var daySchedule = d.schedule[dateKey];
        
        ['grade1', 'grade2', 'grade3'].forEach(function(gradeId, gradeIndex) {
            var assignments = daySchedule[gradeId] || [];
            
            assignments.forEach(function(assignment, assignmentIndex) {
                if (!assignment || !assignment.teacherId) return;
                
                var teacher = null;
                for (var i = 0; i < d.teachers.length; i++) {
                    if (d.teachers[i].id === assignment.teacherId) {
                        teacher = d.teachers[i];
                        break;
                    }
                }
                
                if (!teacher || teacher.name !== name) return;
                
                var date = new Date(y, m - 1, day);
                var dow = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
                var assignedCount = assignments.filter(function(a) { return a && a.teacherId; }).length;
                var loc = assignedCount > 1 ? (
                    assignment.location === 'stairs' ? 'ê³„ë‹¨' : 
                    assignment.location === 'entrance' ? 'ê¸‰ì‹ì†Œ ì…êµ¬' : ''
                ) : '';
                
                result.push({
                    day: day,
                    date: m + 'ì›” ' + day + 'ì¼',
                    dow: dow,
                    grade: (gradeIndex + 1) + 'í•™ë…„',
                    loc: loc,
                    gradeId: gradeId,
                    assignmentIndex: assignmentIndex
                });
            });
        });
    });
    
    return result.sort(function(a, b) { return a.day - b.day; });
}

function getNext(d, currentDuty) {
    var mm = String(d.month).padStart(2, '0');
    var currentLocation = null;
    
    // í˜„ì¬ ë‚ ì§œì˜ ë‚´ ìœ„ì¹˜(location) ì°¾ê¸°
    var currentDateKey = d.year + '-' + mm + '-' + String(currentDuty.day).padStart(2, '0');
    var currentDaySchedule = d.schedule[currentDateKey];
    if (currentDaySchedule) {
        var currentAssignments = currentDaySchedule[currentDuty.gradeId] || [];
        var currentAssignment = currentAssignments[currentDuty.assignmentIndex];
        if (currentAssignment) {
            currentLocation = currentAssignment.location; // 'stairs' ë˜ëŠ” 'entrance'
        }
    }
    
    // ë‹¤ìŒ ë‚ ë¶€í„° ê°™ì€ í•™ë…„, ê°™ì€ ìœ„ì¹˜ë¥¼ ì°¾ê¸°
    for (var day = currentDuty.day + 1; day <= 31; day++) {
        var dd = String(day).padStart(2, '0');
        var dateKey = d.year + '-' + mm + '-' + dd;
        var daySchedule = d.schedule[dateKey];
        
        if (!daySchedule) continue;
        
        var assignments = daySchedule[currentDuty.gradeId] || [];
        
        // ê°™ì€ ìœ„ì¹˜(location)ë¥¼ ê°€ì§„ ì„ ìƒë‹˜ ì°¾ê¸°
        for (var i = 0; i < assignments.length; i++) {
            var assignment = assignments[i];
            if (assignment && assignment.teacherId && assignment.location === currentLocation) {
                var teacher = null;
                for (var j = 0; j < d.teachers.length; j++) {
                    if (d.teachers[j].id === assignment.teacherId) {
                        teacher = d.teachers[j];
                        break;
                    }
                }
                
                if (teacher) {
                    return {
                        name: teacher.name,
                        date: d.month + 'ì›” ' + day + 'ì¼'
                    };
                }
            }
        }
    }
    
    return null;
}

function getTotalCount(name) {
    var count = 0;
    
    schedules.forEach(function(monthData) {
        Object.values(monthData.schedule).forEach(function(daySchedule) {
            ['grade1', 'grade2', 'grade3'].forEach(function(gradeId) {
                var assignments = daySchedule[gradeId] || [];
                
                assignments.forEach(function(assignment) {
                    if (!assignment || !assignment.teacherId) return;
                    
                    var teacher = null;
                    for (var i = 0; i < monthData.teachers.length; i++) {
                        if (monthData.teachers[i].id === assignment.teacherId) {
                            teacher = monthData.teachers[i];
                            break;
                        }
                    }
                    
                    if (teacher && teacher.name === name) {
                        count++;
                    }
                });
            });
        });
    });
    
    return count;
}

function showMsg(text, type) {
    document.getElementById('msg-area').innerHTML = '<div class="msg msg-' + type + '">' + text + '</div>';
    setTimeout(function() {
        document.getElementById('msg-area').innerHTML = '';
    }, 4000);
}
</script>
</body>
</html>
